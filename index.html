<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Camera Tracker (Browser-Only)</title>
    <style>
      body {
        background: #111;
        color: #fff;
        text-align: center;
        font-family: sans-serif;
      }
      video, canvas {
        width: 640px;
        height: 480px;
        border: 2px solid #00ffcc;
        border-radius: 8px;
        margin-top: 10px;
      }
    </style>

    <!-- Load MediaPipe Pose and Camera Utils -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
  </head>
  <body>
    <h1>Exoskeleton Tracker (Mediapipe JS)</h1>
    <video id="video" autoplay playsinline></video>
    <canvas id="output"></canvas>

    <script>
      const videoElement = document.getElementById('video');
      const canvasElement = document.getElementById('output');
      const canvasCtx = canvasElement.getContext('2d');

      const pose = new Pose.Pose({
        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
      });

      pose.setOptions({
        modelComplexity: 1,
        smoothLandmarks: true,
        enableSegmentation: false,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });

      pose.onResults((results) => {
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

        if (results.poseLandmarks) {
          canvasCtx.fillStyle = "red";
          results.poseLandmarks.forEach(p => {
            canvasCtx.beginPath();
            canvasCtx.arc(p.x * canvasElement.width, p.y * canvasElement.height, 5, 0, 2 * Math.PI);
            canvasCtx.fill();
          });

          const connections = Pose.POSE_CONNECTIONS;
          canvasCtx.strokeStyle = "#00ffcc";
          canvasCtx.lineWidth = 2;
          connections.forEach(([a, b]) => {
            const p1 = results.poseLandmarks[a];
            const p2 = results.poseLandmarks[b];
            canvasCtx.beginPath();
            canvasCtx.moveTo(p1.x * canvasElement.width, p1.y * canvasElement.height);
            canvasCtx.lineTo(p2.x * canvasElement.width, p2.y * canvasElement.height);
            canvasCtx.stroke();
          });
        }
        canvasCtx.restore();
      });

      const camera = new CameraUtils.Camera(videoElement, {
        onFrame: async () => {
          await pose.send({ image: videoElement });
        },
        width: 640,
        height: 480
      });
      camera.start();
    </script>
  </body>
</html>
